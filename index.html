<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>지욱님의 웹프레젠테이션 모음</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light only" />
  <style>
    :root {
      --bg: #f0f8ff;
      --text: #222;
      --muted: #444;
      --card: #fff;
      --card-border: #e6eef6;
      --link: #007acc;
      --link-hover: #005a99;
      --focus: #bfe4ff;
    }
    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", sans-serif;
      color: var(--text);
    }
    main {
      padding: 40px 28px;
      max-width: 920px;
      margin: 0 auto;
    }
    h1 { margin: 0 0 10px; font-size: 28px; line-height: 1.3; }
    p.desc { margin: 0 0 24px; color: var(--muted); }
    .toolbar { display: flex; gap: 10px; align-items: center; margin-bottom: 18px; color: #555; font-size: 14px; flex-wrap: wrap; }
    .toolbar .reload { padding: 6px 10px; background: #fff; border: 1px solid var(--card-border); border-radius: 8px; cursor: pointer; }
    ul.list { list-style: none; padding-left: 0; margin: 0; }
    .item { background: var(--card); border: 1px solid var(--card-border); border-radius: 10px; padding: 16px 18px; margin-bottom: 14px; }
    .item h2 { margin: 0 0 4px; font-size: 20px; line-height: 1.4; font-weight: 600; }
    .item h2 a { color: var(--link); text-decoration: none; }
    .item h2 a:hover { color: var(--link-hover); text-decoration: underline; }
    .item h2 a:focus-visible { outline: 3px solid var(--focus); outline-offset: 3px; border-radius: 6px; }
    .item .path { margin: 0; color: #667; font-size: 13px; word-break: break-all; opacity: .9; }
    .empty, .error, .loading { background: #fffdf5; border: 1px dashed #ecd9a2; color: #6b5d2d; padding: 14px 16px; border-radius: 10px; margin: 16px 0; font-size: 14px; }
    .error { background: #fff5f5; border-color: #f2c7c7; color: #7a2e2e; }
    .loading { background: #f5fbff; border-color: #cfe7f7; color: #214a6b; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
  </style>
</head>
<body>
  <main>
    <h1>지욱님의 웹프레젠테이션 모음</h1>
    <p class="desc">아래 <strong>제목</strong>을 클릭하면 프레젠테이션 페이지로 이동합니다.</p>

    <div class="toolbar" aria-live="polite" aria-atomic="true">
      <button class="reload" id="reloadBtn" type="button">목록 새로고침</button>
      <span class="hint">하위(손자) 폴더까지 자동 인식해, <code>index.html</code>이 있는 폴더만 보여줘요.</span>
      <span class="sr-only" id="liveRegion"></span>
    </div>

    <div id="status"></div>
    <ul class="list" id="list"></ul>
  </main>

  <script>
    // ====== 구성 ======
    const CONFIG = {
      owner: 'beside1s-lgtm',
      repo: 'wallaby',
      branch: 'main',
      basePath: 'my presentation', // 이 폴더부터 탐색
      maxDepth: 2,                 // 손자 폴더까지 확인
      excludeDirs: ['.git', '.github', 'assets', 'img', 'images', 'node_modules'],
      // token: 'ghp_xxx', // 필요 시 사용(공개 저장소에 커밋 금지)
      titleMap: {
        // 'my presentation/Development_process': 'FIREBASE STUDIO와 함께 한 KIS 스쿨버스 매니저 개발 과정'
      }
    };

    // ====== 유틸 ======
    const $ = (sel) => document.querySelector(sel);
    const encodePathSegments = (p) => p.split('/').filter(Boolean).map(encodeURIComponent).join('/');
    const toApiUrl = (path='') =>
      `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${encodePathSegments(path)}?ref=${encodeURIComponent(CONFIG.branch)}`;
    const toPagesUrl = (path='') =>
      `https://${CONFIG.owner}.github.io/${CONFIG.repo}/${encodePathSegments(path)}/`;
    const hasIndexFile = (entries) => {
      if (!Array.isArray(entries)) return false;
      const names = new Set(entries.map(e => (e.name || '').toLowerCase()));
      return names.has('index.html') || names.has('index.htm') || names.has('index.md');
    };
    const isDirEntry = (e) => e && e.type === 'dir';
    const shouldExclude = (name) => CONFIG.excludeDirs.some(ex => ex.toLowerCase() === name.toLowerCase());
    const prettyTitle = (path) => {
      const mapped = CONFIG.titleMap[path];
      if (mapped) return mapped;
      const last = path.split('/').filter(Boolean).pop() || path;
      return last.replace(/[-_]+/g, ' ');
    };
    const headers = () => {
      const h = { 'Accept': 'application/vnd.github.v3+json' };
      if (CONFIG.token) h['Authorization'] = `Bearer ${CONFIG.token}`;
      return h;
    };

    // ====== GitHub API ======
    async function fetchDirEntries(path) {
      const res = await fetch(toApiUrl(path), { headers: headers() });
      if (!res.ok) throw new Error(`GitHub API 오류(${res.status}) - ${path || '(repo root)'}`);
      return await res.json();
    }

    async function findPresentations(startPath='', depth=1) {
      const results = [];
      const queue = [{ path: startPath, depth: 0 }];

      while (queue.length) {
        const { path, depth: d } = queue.shift();
        const entries = await fetchDirEntries(path);

        const dirs = entries.filter(isDirEntry).filter(e => !shouldExclude(e.name));

        for (const dir of dirs) {
          const childPath = [path, dir.name].filter(Boolean).join('/');

          let childEntries;
          try {
            childEntries = await fetchDirEntries(childPath);
          } catch (_) {
            continue;
          }

          if (hasIndexFile(childEntries)) {
            results.push({
              path: childPath,
              url: toPagesUrl(childPath),
              title: prettyTitle(childPath)
            });
          }

          if (d + 1 < CONFIG.maxDepth) {
            queue.push({ path: childPath, depth: d + 1 });
          }
        }
      }

      results.sort((a, b) => a.title.localeCompare(b.title, 'ko'));
      return results;
    }

    // ====== 렌더링 ======
    function renderList(items) {
      const listEl = $('#list');
      listEl.innerHTML = '';

      if (!items.length) {
        $('#status').innerHTML = '<div class="empty">표시할 프레젠테이션 디렉토리가 없습니다. (폴더 안에 <code>index.html</code>이 있어야 해요)</div>';
        return;
      }

      const frag = document.createDocumentFragment();

      for (const item of items) {
        const li = document.createElement('li');
        li.className = 'item';

        const h2 = document.createElement('h2');
        const a = document.createElement('a');
        a.href = item.url;
        a.textContent = item.title;
        a.rel = 'noopener';
        a.target = '_blank';
        h2.appendChild(a);

        const p = document.createElement('p');
        p.className = 'path';
        p.textContent = `/${item.path}/`;

        li.appendChild(h2);
        li.appendChild(p);
        frag.appendChild(li);
      }

      $('#status').innerHTML = '';
      listEl.appendChild(frag);
    }

    function setLoading(on, text='목록을 불러오는 중...') {
      const live = $('#liveRegion');
      if (on) {
        $('#status').innerHTML = `<div class="loading">${text}</div>`;
        live.textContent = text;
      } else {
        $('#status').innerHTML = '';
        live.textContent = '';
      }
    }

    function setError(msg) {
      $('#status').innerHTML = `<div class="error">불러오기 실패: ${msg}<br/>잠시 후 다시 시도해 주세요. (GitHub API 제한일 수 있어요)</div>`;
      $('#liveRegion').textContent = `오류: ${msg}`;
    }

    // ====== 시작 ======
    async function load() {
      setLoading(true);
      try {
        const items = await findPresentations(CONFIG.basePath, CONFIG.maxDepth);
        renderList(items);
      } catch (err) {
        setError(err.message || String(err));
      } finally {
        setLoading(false, '');
      }
    }

    $('#reloadBtn').addEventListener('click', load);
    load();
  </script>
</body>
</html>
